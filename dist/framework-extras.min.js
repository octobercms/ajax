(()=>{"use strict";var e={};function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.amdO={};var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,o,i;return n=e,i=[{key:"load",value:function(t,n){return(new e).loadCollection(t,n)}}],(o=[{key:"loadCollection",value:function(e,t){var n=this,o=e.js?e.js:[],i=e.css?e.css:[],a=e.img?e.img:[];o=r(o,(function(e){return!document.querySelector('head script[src="'+e+'"]')})),i=r(i,(function(e){return!document.querySelector('head link[href="'+e+'"]')}));var s=0,u=!1,l=!1;function c(){return!!l&&!!u&&!(s<i.length)&&void(t&&t())}0!==o.length||0!==i.length||0!==a.length?(this.loadJavaScript(o,(function(){u=!0,c()})),i.forEach((function(e){n.loadStyleSheet(e,(function(){s++,c()}))})),this.loadImage(a,(function(){l=!0,c()}))):t&&t()}},{key:"loadStyleSheet",value:function(e,t){var n=document.createElement("link");return n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",e),n.addEventListener("load",t,!1),void 0!==n&&document.getElementsByTagName("head")[0].appendChild(n),n}},{key:"loadJavaScript",value:function(e,t){if(e.length<=0)return t();var n=this,r=e.shift(),o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",r),o.addEventListener("load",(function(){n.loadJavaScript(e,t)}),!1),void 0!==o&&document.getElementsByTagName("head")[0].appendChild(o)}},{key:"loadImage",value:function(e,t){if(e.length<=0)return t();var n=0;e.forEach((function(r){var o=new Image;o.onload=function(){++n==e.length&&t&&t()},o.src=r}))}}])&&t(n.prototype,o),i&&t(n,i),Object.defineProperty(n,"prototype",{writable:!1}),e}();function r(e,t){for(var n=[],r=e.length,o=0;o<r;o++)t(e[o])&&n.push(e[o]);return n}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t)throw new Error("The request handler name is not specified.");if(!t.match(/^(?:\w+\:{2})?on*/))throw new Error('Invalid handler name. The correct handler name format is: "onEvent".');if("undefined"==typeof FormData)throw new Error("The browser does not support the FormData interface.");this.options=n,this.handler=t}var t,n,r;return t=e,n=[{key:"getRequestOptions",value:function(){return{method:"POST",url:this.options.url?this.options.url:window.location.href,headers:this.buildHeaders(),responseType:!1===this.options.download?"":"blob"}}},{key:"buildHeaders",value:function(){var e=this.handler,t=this.options,n={"X-Requested-With":"XMLHttpRequest","X-OCTOBER-REQUEST-HANDLER":e};t.files||(n["Content-Type"]=t.bulk?"application/json":"application/x-www-form-urlencoded"),t.flash&&(n["X-OCTOBER-REQUEST-FLASH"]=1),t.partial&&(n["X-OCTOBER-REQUEST-PARTIAL"]=t.partial);var r=this.extractPartials(t.update,t.partial);r&&(n["X-OCTOBER-REQUEST-PARTIALS"]=r);var o=this.getXSRFToken();o&&(n["X-XSRF-TOKEN"]=o);var i=this.getCSRFToken();return i&&(n["X-CSRF-TOKEN"]=i),t.headers&&t.headers.constructor==={}.constructor&&Object.assign(n,t.headers),n}},{key:"extractPartials",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=[];if(e){if("object"!==o(e))throw new Error("Invalid update value. The correct format is an object ({...})");for(var r in e)"_self"===r&&t?n.push(t):n.push(r)}return n.join("&")}},{key:"getCSRFToken",value:function(){var e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):null}},{key:"getXSRFToken",value:function(){var e=null;if(document.cookie&&""!=document.cookie)for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var r=t[n].replace(/^([\s]*)|([\s]*)$/g,"");if("XSRF-TOKEN="==r.substring(0,11)){e=decodeURIComponent(r.substring(11));break}}return e}}],r=[{key:"fetch",value:function(e,t){return new this(e,t).getRequestOptions()}}],n&&i(t.prototype,n),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.target,r=void 0===n?document:n,o=t.detail,i=void 0===o?{}:o,a=t.bubbles,s=void 0===a||a,u=t.cancelable,l=void 0===u||u,c=new CustomEvent(e,{detail:i,bubbles:s,cancelable:l});return r.dispatchEvent(c),c}function u(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=l(c(e,n)).split("\n"),i=o[0].match(/^\s+/),a=i?i[0].length:0;return o.map((function(e){return e.slice(a)})).join("\n")}function l(e){return e.replace(/^\n/,"")}function c(e,t){return e.reduce((function(e,n,r){return e+n+(null==t[r]?"":t[r])}),"")}function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=d(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=/[^.]*(?=\..*)\.|.*/,m=/\..*/,g=/::\d+$/,b={},k=1,w={mouseenter:"mouseover",mouseleave:"mouseout"},E=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]),A=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"on",value:function(e,t,n,r,o){T(e,t,n,r,o,!1)}},{key:"one",value:function(e,t,n,r,o){T(e,t,n,r,o,!0)}},{key:"off",value:function(e,t,n,r,o){if("string"==typeof t&&e){var i=h(S(t,n,r,o),4),a=i[0],s=i[1],u=i[2],l=i[3],c=u!==t,f=j(e),d=f[u]||{},p=t.startsWith(".");if(void 0===s){if(p)for(var y=0,v=Object.keys(f);y<v.length;y++)B(e,f,v[y],t.slice(1));for(var m=0,b=Object.keys(d);m<b.length;m++){var k=b[m],w=k.replace(g,"");if(!c||t.includes(w)){var E=d[k];C(e,f,u,E.callable,E.delegationSelector,l)}}}else{if(!d)return;C(e,f,u,s,a?n:null,l)}}}},{key:"dispatch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.target,r=void 0===n?document:n,o=t.detail,i=void 0===o?{}:o,a=t.bubbles,u=void 0===a||a,l=t.cancelable,c=void 0===l||l;return s(e,{target:r,detail:i,bubbles:u,cancelable:c})}}],(n=null)&&y(t.prototype,n),r&&y(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function O(e,t){return t&&"".concat(t,"::").concat(k++)||e.uidEvent||k++}function j(e){var t=O(e);return e.uidEvent=t,b[t]=b[t]||{},b[t]}function x(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object.values(e).find((function(e){return e.callable===t&&e.delegationSelector===n}))}function S(e,t,n,r){var o,i="string"==typeof t,a=i?n:t,s=i?r:n,u=(o=(o=e).replace(m,""),w[o]||o);return E.has(u)||(u=e),[i,a,u,s]}function T(e,t,n,r,o,i){if("string"==typeof t&&e){var a=h(S(t,n,r,o),4),s=a[0],u=a[1],l=a[2],c=a[3];if(t in w){u=function(e){return function(t){if(!t.relatedTarget||t.relatedTarget!==t.delegateTarget&&!t.delegateTarget.contains(t.relatedTarget))return e.call(this,t)}}(u)}var d=j(e),p=d[l]||(d[l]={}),y=x(p,u,s?n:null);if(y)y.oneOff=y.oneOff&&i;else{var m=O(u,t.replace(v,"")),g=s?function(e,t,n){return function r(o){for(var i=e.querySelectorAll(t),a=o.target;a&&a!==this;a=a.parentNode){var s,u=f(i);try{for(u.s();!(s=u.n()).done;){if(s.value===a)return o.delegateTarget=a,r.oneOff&&A.off(e,o.type,t,n),n.apply(a,[o])}}catch(e){u.e(e)}finally{u.f()}}}}(e,n,u):function(e,t){return function n(r){return r.delegateTarget=e,n.oneOff&&A.off(e,r.type,t),t.apply(e,[r])}}(e,u);g.delegationSelector=s?n:null,g.callable=u,g.oneOff=i,g.uidEvent=m,p[m]=g,e.addEventListener(l,g,c)}}}function C(e,t,n,r,o,i){var a=x(t[n],r,o);a&&(e.removeEventListener(n,a,i),delete t[n][a.uidEvent])}function B(e,t,n,r){for(var o=t[n]||{},i=0,a=Object.keys(o);i<a.length;i++){var s=a[i];if(s.includes(r)){var u=o[s];C(e,t,n,u.callable,u.delegationSelector)}}}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var P=0,R=-1,F=-2,L=-3,I=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.failed=!1,this.progress=0,this.sent=!1,this.delegate=t,this.url=n,this.options=r,this.headers=r.headers||{},this.method=r.method||"GET",this.responseType=r.responseType||"",this.data=r.data,this.timeout=r.timeout||0,this.requestProgressed=function(e){e.lengthComputable&&o.setProgress(e.loaded/e.total)},this.requestLoaded=function(){o.endRequest((function(e){o.processResponseData(e,(function(e,t){var n=e.getResponseHeader("Content-Type"),r=function(e){return(e||"").includes("application/json")}(n)?JSON.parse(t):t;if(o.options.htmlOnly&&!function(e){return(e||"").match(/^text\/html|^application\/xhtml\+xml/)}(n))return o.failed=!0,void o.delegate.requestFailedWithStatusCode(F);e.status>=200&&e.status<300?o.delegate.requestCompletedWithResponse(r,e.status,function(e,t){if(e.getResponseHeader("X-OCTOBER-LOCATION"))return e.getResponseHeader("X-OCTOBER-LOCATION");var n=t.match(/^(.*)#/);return(n?n[1]:t)!==e.responseURL?e.responseURL:null}(e,o.url)):(o.failed=!0,o.delegate.requestFailedWithStatusCode(e.status,r))}))}))},this.requestFailed=function(){o.endRequest((function(){o.failed=!0,o.delegate.requestFailedWithStatusCode(P)}))},this.requestTimedOut=function(){o.endRequest((function(){o.failed=!0,o.delegate.requestFailedWithStatusCode(R)}))},this.requestCanceled=function(){o.options.trackAbort?o.endRequest((function(){o.failed=!0,o.delegate.requestFailedWithStatusCode(L)})):o.endRequest()},this.createXHR()}var t,n,r;return t=e,n=[{key:"send",value:function(){this.xhr&&!this.sent&&(this.notifyApplicationBeforeRequestStart(),this.setProgress(0),this.xhr.send(this.data||null),this.sent=!0,this.delegate.requestStarted())}},{key:"abort",value:function(){this.xhr&&this.sent&&this.xhr.abort()}},{key:"notifyApplicationBeforeRequestStart",value:function(){A.dispatch("ajax:request-start",{detail:{url:this.url,xhr:this.xhr},cancelable:!1})}},{key:"notifyApplicationAfterRequestEnd",value:function(){A.dispatch("ajax:request-end",{detail:{url:this.url,xhr:this.xhr},cancelable:!1})}},{key:"createXHR",value:function(){var e=this.xhr=new XMLHttpRequest;for(var t in e.open(this.method,this.url,!0),e.responseType=this.responseType,e.onprogress=this.requestProgressed,e.onload=this.requestLoaded,e.onerror=this.requestFailed,e.ontimeout=this.requestTimedOut,e.onabort=this.requestCanceled,this.timeout&&(e.timeout=1e3*this.timeout),this.headers)e.setRequestHeader(t,this.headers[t]);return e}},{key:"endRequest",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.xhr&&(this.notifyApplicationAfterRequestEnd(),e(this.xhr),this.destroy())}},{key:"setProgress",value:function(e){this.progress=e,this.delegate.requestProgressed(e)}},{key:"destroy",value:function(){this.setProgress(1),this.delegate.requestFinished()}},{key:"processResponseData",value:function(e,t){if("blob"===this.responseType){var n=e.getResponseHeader("Content-Disposition")||"";if(0!==n.indexOf("attachment")&&0!==n.indexOf("inline")){var r=new FileReader;r.addEventListener("load",(function(){t(e,r.result)})),r.readAsText(e.response)}else t(e,e.response)}else t(e,e.responseText)}}],n&&q(t.prototype,n),r&&q(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D="pending",N="rejected",U="resolved",J=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t||{},this.stateStr=D,this.successFuncs=[],this.failureFuncs=[],this.progressFuncs=[],this.resolveArgs=[],this.rejectArgs=[],this.progressArgs=[],this.isProgressNotified=!1}var t,n,r;return t=e,n=[{key:"resolve",value:function(){return this.stateStr===D&&(this.resolveArgs=arguments,this.callFunction.call(this,this.successFuncs,this.resolveArgs),this.stateStr=U),this}},{key:"reject",value:function(){return this.stateStr===D&&(this.rejectArgs=arguments,this.callFunction.call(this,this.failureFuncs,this.rejectArgs),this.stateStr=N),this}},{key:"notify",value:function(){return this.stateStr===D&&(this.progressArgs=arguments,this.callFunction.call(this,this.progressFuncs,this.progressArgs),this.isProgressNotified=!0),this}},{key:"abort",value:function(){this.options.delegate&&this.options.delegate.abort()}},{key:"done",value:function(){var e=Array.prototype.slice.call(arguments);return this.successFuncs=this.successFuncs.concat(e),this.stateStr===U&&this.callFunction.call(this,e,this.resolveArgs),this}},{key:"fail",value:function(){var e=Array.prototype.slice.call(arguments);return this.failureFuncs=this.failureFuncs.concat(e),this.stateStr===N&&this.callFunction.call(this,e,this.rejectArgs),this}},{key:"progress",value:function(){var e=Array.prototype.slice.call(arguments);return this.progressFuncs=this.progressFuncs.concat(e),this.stateStr===D&&this.isProgressNotified&&this.callFunction.call(this,e,this.progressArgs),this}},{key:"always",value:function(){var e=Array.prototype.slice.call(arguments);return this.successFuncs=this.successFuncs.concat(e),this.failureFuncs=this.failureFuncs.concat(e),this.stateStr!==D&&this.callFunction.call(this,e,this.resolveArgs||this.rejectArgs),this}},{key:"then",value:function(){var e=[];for(var t in arguments){var n;n=Array.isArray(arguments[t])?arguments[t]:[arguments[t]],e.push(n)}return this.done.apply(this,e[0]),this.fail.apply(this,e[1]),this.progress.apply(this,e[2]),this}},{key:"promise",value:function(){var e=["resolve","reject","promise","notify"],t={};for(var n in this)-1===e.indexOf(n)&&(t[n]=this[n]);return t}},{key:"state",value:function(){return arguments.length>0&&(stateStr=arguments[0]),stateStr}},{key:"callFunction",value:function(e,t,n){var r=(n=n||{}).scope||this;for(var o in e){var i=e[o];"function"==typeof i&&i.apply(r,t)}}}],n&&M(t.prototype,n),r&&M(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function H(e){return function(e){if(Array.isArray(e))return X(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return X(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var W="replace",G="prepend",Z="append",Y="update",ee=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t.el,this.delegate=t,this.context=n,this.options=r,this.context.start=this.start.bind(this),this.context.success=this.success.bind(this),this.context.error=this.error.bind(this),this.context.complete=this.complete.bind(this),this.context.cancel=this.cancel.bind(this)}var t,r,o;return t=e,(r=[{key:"invoke",value:function(e,t){return this.options[e]?this.options[e].apply(this.context,t):this[e]?this[e].apply(this,H(t)):void 0}},{key:"invokeFunc",value:function(e,t){if(this.options[e])return this.options[e](this.el,t)}},{key:"start",value:function(e){this.invoke("markAsUpdating",[!0])}},{key:"success",value:function(e,t,n){var r=this,o=new J;if(!1===this.invoke("beforeUpdate",[e,t,n]))return o;if(!1===this.invokeFunc("beforeUpdateFunc",e))return o;if(!this.delegate.applicationAllowsUpdate(e,t,n))return o;if(this.delegate.options.download&&e instanceof Blob&&this.invoke("handleFileDownload",[e,n]))return o;if(this.delegate.options.flash&&e.X_OCTOBER_FLASH_MESSAGES)for(var i in e.X_OCTOBER_FLASH_MESSAGES)this.invoke("handleFlashMessage",[e.X_OCTOBER_FLASH_MESSAGES[i],i]);return e.X_OCTOBER_DISPATCHES&&this.invoke("handleBrowserEvents",[e.X_OCTOBER_DISPATCHES])||(o=this.invoke("handleUpdateResponse",[e,t,n])).done((function(){r.delegate.notifyApplicationRequestSuccess(e,t,n),r.invokeFunc("successFunc",e)})),o}},{key:"error",value:function(e,t,n){var r,o=this,i=new J;if(void 0!==window.ocUnloading&&window.ocUnloading||t==L)return i;if(this.delegate.toggleRedirect(!1),406==t&&e){if(e.X_OCTOBER_DISPATCHES&&this.invoke("handleBrowserEvents",[e.X_OCTOBER_DISPATCHES]))return i;r=e.X_OCTOBER_ERROR_MESSAGE,i=this.invoke("handleUpdateResponse",[e,t,n])}else r=e,i.resolve();return i.done((function(){o.el!==document&&o.el.setAttribute("data-error-message",r),o.delegate.applicationAllowsError(e,t,n)&&!1!==o.invokeFunc("errorFunc",e)&&o.invoke("handleErrorMessage",[r])})),i}},{key:"complete",value:function(e,t,n){this.delegate.notifyApplicationRequestComplete(e,t,n),this.invokeFunc("completeFunc",e),this.invoke("markAsUpdating",[!1])}},{key:"cancel",value:function(){this.invokeFunc("cancelFunc")}},{key:"handleConfirmMessage",value:function(e){var t=this,n=new J;if(n.done((function(){t.delegate.sendInternal()})).fail((function(){t.invoke("cancel")})),this.delegate.notifyApplicationConfirmMessage(e,n).defaultPrevented)return!1;if(e){var r=confirm(e);return r||this.invoke("cancel"),r}}},{key:"handleFlashMessage",value:function(e,t){}},{key:"handleErrorMessage",value:function(e){this.delegate.notifyApplicationErrorMessage(e).defaultPrevented||e&&alert(e)}},{key:"handleValidationMessage",value:function(e,t){if(this.delegate.notifyApplicationBeforeValidate(e,t),this.delegate.formEl){var n=!0;for(var r in t){var o,i=[];o=r.replace(/\.(\w+)/g,"[$1]"),i.push('[name="'+o+'"]:not([disabled])'),i.push('[name="'+o+'[]"]:not([disabled])'),o=("."+r).replace(/\.(\w+)/g,"[$1]"),i.push('[name$="'+o+'"]:not([disabled])'),i.push('[name$="'+o+'[]"]:not([disabled])');var a=r.replace(/\.[0-9]+$/g,"");r!==a&&(o=a.replace(/\.(\w+)/g,"[$1]"),i.push('[name="'+o+'[]"]:not([disabled])'),o=("."+a).replace(/\.(\w+)/g,"[$1]"),i.push('[name$="'+o+'[]"]:not([disabled])'));var s=this.delegate.formEl.querySelector(i.join(", "));if(s){var u=this.delegate.notifyApplicationFieldInvalid(s,r,t[r],n);n&&(u.defaultPrevented||s.focus(),n=!1)}}}}},{key:"handleBrowserEvents",value:function(e){var t=this;if(!e||!e.length)return!1;var n=!1;return e.forEach((function(e){t.delegate.notifyApplicationCustomEvent(e.event,K(K({},e.data||{}),{},{context:t.context})).defaultPrevented&&(n=!0)})),n}},{key:"handleRedirectResponse",value:function(e){this.delegate.notifyApplicationBeforeRedirect().defaultPrevented||(oc.useTurbo&&oc.useTurbo()?oc.visit(e):location.assign(e))}},{key:"markAsUpdating",value:function(e){var t=this.options.update||{};for(var n in t){var r=t[n],o=[];t._self&&n==this.options.partial&&this.delegate.partialEl?(r=t._self,o=[this.delegate.partialEl]):o=te(r,'[data-ajax-partial="'+n+'"]'),o.forEach((function(t){e?t.setAttribute("data-ajax-updating",""):t.removeAttribute("data-ajax-updating")}))}}},{key:"handleUpdateResponse",value:function(e,t,r){var o=this,i=this.options.update||{},a=new J;return a.done((function(){var n=function(){var n=i[a]||a,s=[];i._self&&a==o.options.partial&&o.delegate.partialEl?(n=i._self,s=[o.delegate.partialEl]):s=te(n,'[data-ajax-partial="'+a+'"]'),s.forEach((function(i){var s=function(e,t){if("string"==typeof e){if("!"===e.charAt(0))return W;if("@"===e.charAt(0))return Z;if("^"===e.charAt(0))return G}return void 0!==t.dataset.ajaxUpdateMode?t.dataset.ajaxUpdateMode:Y}(n,i);if(s===W){var u=i.parentNode;i.insertAdjacentHTML("afterEnd",e[a]),u.removeChild(i),ne(u,e[a])}else s===Z?(i.insertAdjacentHTML("beforeEnd",e[a]),ne(i,e[a])):s===G?(i.insertAdjacentHTML("afterBegin",e[a]),ne(i,e[a])):(o.delegate.notifyApplicationBeforeReplace(i),i.innerHTML=e[a],function(e){Array.from(e.querySelectorAll("script")).forEach((function(e){var t=document.createElement("script");Array.from(e.attributes).forEach((function(e){return t.setAttribute(e.name,e.value)})),t.appendChild(document.createTextNode(e.innerHTML)),e.parentNode.replaceChild(t,e)}))}(i));o.delegate.notifyApplicationAjaxUpdate(i,e,t,r)}))};for(var a in e)n();setTimeout((function(){o.delegate.notifyApplicationUpdateComplete(e,t,r),o.invoke("afterUpdate",[e,t,r]),o.invokeFunc("afterUpdateFunc",e)}),0)})),e.X_OCTOBER_REDIRECT&&this.delegate.toggleRedirect(e.X_OCTOBER_REDIRECT),this.delegate.isRedirect&&this.invoke("handleRedirectResponse",[this.delegate.options.redirect]),e.X_OCTOBER_ERROR_FIELDS&&this.invoke("handleValidationMessage",[e.X_OCTOBER_ERROR_MESSAGE,e.X_OCTOBER_ERROR_FIELDS]),e.X_OCTOBER_ASSETS?n.load(e.X_OCTOBER_ASSETS,(function(){return a.resolve()})):a.resolve(),a}},{key:"handleFileDownload",value:function(e,t){if(this.options.browserTarget)return window.open(window.URL.createObjectURL(e),this.options.browserTarget),!0;var n="string"==typeof this.options.download?this.options.download:function(e){var t=e.getResponseHeader("Content-Disposition");if(!t)return null;for(var n=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/g,r=null,o=null;null!==(o=n.exec(t));)r=o;return null!==r&&r[1]?null===/filename[^;*=\n]*\*=[^']*''/.exec(r[0])?r[1].replace(/['"]/g,""):decodeURIComponent(r[1].substring(r[1].indexOf("''")+2)):null}(t);if(n){var r=document.createElement("a");return r.href=window.URL.createObjectURL(e),r.download=n,r.target="_blank",r.click(),window.URL.revokeObjectURL(r.href),!0}}},{key:"applyQueryToUrl",value:function(e){for(var t=new URLSearchParams(window.location.search),n=function(){var n=o[r],i=e[n];Array.isArray(i)?(t.delete(n),t.delete("".concat(n,"[]")),i.forEach((function(e){return t.append("".concat(n,"[]"),e)}))):null===i?(t.delete(n),t.delete("".concat(n,"[]"))):t.set(n,i)},r=0,o=Object.keys(e);r<o.length;r++)n();var i=window.location.pathname;t.toString()&&(i+="?"+t.toString().replaceAll("%5B%5D=","[]=")),oc.useTurbo&&oc.useTurbo()?oc.visit(i,{action:"swap",scroll:!1}):(history.replaceState(null,"",i),localStorage.setItem("ocPushStateReferrer",i))}}])&&z(t.prototype,r),o&&z(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function te(e,t){return!0===e?document.querySelectorAll(t):"string"!=typeof e?[e]:-1===["#",".","@","^","!","="].indexOf(e.charAt(0))?[]:(-1!==["@","^","!","="].indexOf(e.charAt(0))&&(e=e.substring(1)),e||(e=t),document.querySelectorAll(e))}function ne(e,t){var n=document.createElement("div");n.innerHTML=t,Array.from(n.querySelectorAll("script")).forEach((function(t){var n=document.createElement("script");Array.from(t.attributes).forEach((function(e){return n.setAttribute(e.name,e.value)})),n.appendChild(document.createTextNode(t.innerHTML)),e.appendChild(n),e.removeChild(n)}))}function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var oe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"assignToObj",value:function(t,n,r){(new e).assignObjectInternal(t,n,r)}},{key:"serializeJSON",value:function(t){return(new e).parseContainer(t)}}],(n=[{key:"parseContainer",value:function(e){var t=this,n={};return e.querySelectorAll("input, textarea, select").forEach((function(e){if(!(!e.name||e.disabled||["file","reset","submit","button"].indexOf(e.type)>-1)&&(!(["checkbox","radio"].indexOf(e.type)>-1)||e.checked)){if("select-multiple"===e.type){var r=[];return Array.from(e.options).forEach((function(t){t.selected&&r.push({name:e.name,value:t.value})})),void t.assignObjectInternal(n,e.name,r)}t.assignObjectInternal(n,e.name,e.value)}})),n}},{key:"assignObjectInternal",value:function(e,t,n){this.assignObjectNested(e,this.nameToArray(t),n)}},{key:"assignObjectNested",value:function(e,t,n){var r=e,o=t.length-1;t.forEach((function(e,t){void 0===r[e]&&(r[e]={}),t===o&&(r[e]=n),r=r[e]}))}},{key:"nameToArray",value:function(e){for(var t,n=/([^\]\[]+)/g,r=[];t=n.exec(e);)r.push(t[0]);return r}}])&&re(t.prototype,n),r&&re(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ae,se=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.userData=t||{},this.targetEl=n,this.formEl=r}var t,n,r;return t=e,(n=[{key:"getRequestData",value:function(){var e;return e=this.formEl?new FormData(this.formEl):new FormData,this.appendSingleInputElement(e),e}},{key:"getAsFormData",value:function(){return this.appendJsonToFormData(this.getRequestData(),this.userData)}},{key:"getAsQueryString",value:function(){return this.convertFormDataToQuery(this.getAsFormData())}},{key:"getAsJsonData",value:function(){return JSON.stringify(this.convertFormDataToJson(this.getAsFormData()))}},{key:"appendSingleInputElement",value:function(e){if(!this.formEl&&this.targetEl&&(t=this.targetEl,["input","select","textarea"].includes((t.tagName||"").toLowerCase()))){var t,n=this.targetEl.name;n&&void 0===this.userData[n]&&("file"===this.targetEl.type?this.targetEl.files.forEach((function(t){e.append(n,t)})):e.append(n,this.targetEl.value))}}},{key:"appendJsonToFormData",value:function(e,t,n){var r=this;for(var o in t){var i=o;n&&(i=n+"["+o+"]");var a=t[o];a&&a.constructor==={}.constructor?this.appendJsonToFormData(e,a,i):a&&a.constructor===[].constructor?a.forEach((function(t,n){t.constructor==={}.constructor||t.constructor===[].constructor?r.appendJsonToFormData(e,t,i+"["+n+"]"):e.append(i+"[]",r.castJsonToFormData(t))})):e.append(i,this.castJsonToFormData(a))}return e}},{key:"convertFormDataToQuery",value:function(e){var t=this.formDataToArray(e);return Object.keys(t).map((function(e){return e.endsWith("[]")?t[e].map((function(t){return encodeURIComponent(e)+"="+encodeURIComponent(t)})).join("&"):encodeURIComponent(e)+"="+encodeURIComponent(t[e])})).join("&")}},{key:"convertFormDataToJson",value:function(e){var t=this.formDataToArray(e),n={};for(var r in t)oe.assignToObj(n,r,t[r]);return n}},{key:"formDataToArray",value:function(e){return Object.fromEntries(Array.from(e.keys()).map((function(t){return[t,t.endsWith("[]")?e.getAll(t):e.getAll(t).pop()]})))}},{key:"castJsonToFormData",value:function(e){return null===e?"":!0===e?"1":!1===e?"0":e}}])&&ie(t.prototype,n),r&&ie(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ce=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stylesheetElement=this.createStylesheetElement(),this.progressElement=this.createProgressElement(),this.hiding=!1,this.value=0,this.visible=!1,this.trickle=function(){t.setValue(t.value+Math.random()/100)}}var t,n,r;return t=e,n=[{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.cssClass&&this.progressElement.classList.add(e.cssClass),this.visible||(this.visible=!0,this.installStylesheetElement(),this.installProgressElement(),this.startTrickling())}},{key:"hide",value:function(){var e=this;this.visible&&!this.hiding&&(this.hiding=!0,this.fadeProgressElement((function(){e.uninstallProgressElement(),e.stopTrickling(),e.visible=!1,e.hiding=!1})))}},{key:"setValue",value:function(e){this.value=e,this.refresh()}},{key:"installStylesheetElement",value:function(){e.stylesheetReady||(document.head.insertBefore(this.stylesheetElement,document.head.firstChild),e.stylesheetReady=!0)}},{key:"installProgressElement",value:function(){this.progressElement.style.width="0",this.progressElement.style.opacity="1",document.documentElement.insertBefore(this.progressElement,document.body),this.refresh()}},{key:"fadeProgressElement",value:function(t){this.progressElement.style.opacity="0",setTimeout(t,1.5*e.animationDuration)}},{key:"uninstallProgressElement",value:function(){this.progressElement.parentNode&&document.documentElement.removeChild(this.progressElement)}},{key:"startTrickling",value:function(){this.trickleInterval||(this.trickleInterval=setInterval(this.trickle,e.animationDuration))}},{key:"stopTrickling",value:function(){clearInterval(this.trickleInterval),delete this.trickleInterval}},{key:"refresh",value:function(){var e=this;requestAnimationFrame((function(){e.progressElement.style.width="".concat(10+90*e.value,"%")}))}},{key:"createStylesheetElement",value:function(){var t=document.createElement("style");return t.textContent=e.defaultCSS,t}},{key:"createProgressElement",value:function(){var e=document.createElement("div");return e.className="oc-progress-bar",e}}],r=[{key:"defaultCSS",get:function(){return u(ae||(t=["\n        .oc-progress-bar {\n            position: fixed;\n            display: block;\n            top: 0;\n            left: 0;\n            height: 3px;\n            background: #0076ff;\n            z-index: 9999;\n            transition:\n                width ","ms ease-out,\n                opacity ","ms ","ms ease-in;\n            transform: translate3d(0, 0, 0);\n        }\n    "],n||(n=t.slice(0)),ae=Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(n)}}))),e.animationDuration,e.animationDuration/2,e.animationDuration/2);var t,n}},{key:"progressBar",get:function(){return{show:function(){var e=fe();e.setValue(0),e.show()},hide:function(){var e=fe();e.setValue(100),e.hide()}}}}],n&&ue(t.prototype,n),r&&ue(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function fe(){return ce.instance||(ce.instance=new ce),ce.instance}function he(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?he(Object(n),!0).forEach((function(t){pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):he(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}le(ce,"instance",null),le(ce,"stylesheetReady",!1),le(ce,"animationDuration",300);const ve=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t,this.handler=n,this.options=de(de({},this.constructor.DEFAULTS),r||{}),this.context={el:t,handler:n,options:this.options},this.progressBar=new ce,this.showProgressBar=function(){o.progressBar.show({cssClass:"is-ajax"})}}var t,n,r;return t=e,r=[{key:"DEFAULTS",get:function(){return{handler:null,update:{},files:!1,bulk:!1,download:!1,browserValidate:!1,browserTarget:null,progressBarDelay:500,progressBar:null}}},{key:"send",value:function(t,n){return new e(document,t,n).start()}},{key:"sendElement",value:function(t,n,r){return"string"==typeof t&&(t=document.querySelector(t)),new e(t,n,r).start()}}],(n=[{key:"start",value:function(){if(this.notifyApplicationAjaxSetup(),this.initOtherElements(),this.preprocessOptions(),this.actions=new ee(this,this.context,this.options),this.validateClientSideForm()&&this.applicationAllowsRequest()&&(!this.options.confirm||this.actions.invoke("handleConfirmMessage",[this.options.confirm])))return this.sendInternal(),this.options.async?this.wrapInAsyncPromise(this.promise):this.promise}},{key:"sendInternal",value:function(){var e,t=this,n=new se(this.options.data,this.el,this.formEl);e=this.options.files?n.getAsFormData():this.options.bulk?n.getAsJsonData():n.getAsQueryString(),this.options.query&&this.actions.invoke("applyQueryToUrl",[this.options.query]);var r=a.fetch(this.handler,this.options),o=r.url,i=r.headers,s=r.method,u=r.responseType;this.request=new I(this,o,{method:s,headers:i,responseType:u,data:e,trackAbort:!0}),this.promise=new J({delegate:this.request}),this.isRedirect=this.options.redirect&&this.options.redirect.length>0,this.notifyApplicationBeforeSend(),this.notifyApplicationAjaxPromise(),this.promise.fail((function(e,n,r){t.isRedirect||t.notifyApplicationAjaxFail(e,n,r)})).done((function(e,n,r){t.isRedirect||t.notifyApplicationAjaxDone(e,n,r)})).always((function(e,n,r){t.notifyApplicationAjaxAlways(e,n,r)})),this.request.send()}},{key:"toggleRedirect",value:function(e){e?(this.options.redirect=e,this.isRedirect=!0):(this.options.redirect=null,this.isRedirect=!1)}},{key:"applicationAllowsRequest",value:function(){return!this.notifyApplicationBeforeRequest().defaultPrevented}},{key:"applicationAllowsUpdate",value:function(e,t,n){return!this.notifyApplicationBeforeUpdate(e,t,n).defaultPrevented}},{key:"applicationAllowsError",value:function(e,t,n){return!this.notifyApplicationRequestError(e,t,n).defaultPrevented}},{key:"notifyApplicationAjaxSetup",value:function(){return s("ajax:setup",{target:this.el,detail:{context:this.context}})}},{key:"notifyApplicationAjaxPromise",value:function(){return s("ajax:promise",{target:this.el,detail:{context:this.context}})}},{key:"notifyApplicationAjaxFail",value:function(e,t,n){return s("ajax:fail",{target:this.el,detail:{context:this.context,data:e,responseCode:t,xhr:n}})}},{key:"notifyApplicationAjaxDone",value:function(e,t,n){return s("ajax:done",{target:this.el,detail:{context:this.context,data:e,responseCode:t,xhr:n}})}},{key:"notifyApplicationAjaxAlways",value:function(e,t,n){return s("ajax:always",{target:this.el,detail:{context:this.context,data:e,responseCode:t,xhr:n}})}},{key:"notifyApplicationAjaxUpdate",value:function(e,t,n,r){return s("ajax:update",{target:e,detail:{context:this.context,data:t,responseCode:n,xhr:r}})}},{key:"notifyApplicationBeforeRedirect",value:function(){return s("ajax:before-redirect",{target:this.el})}},{key:"notifyApplicationBeforeRequest",value:function(){return s("ajax:before-request",{target:this.triggerEl,detail:{context:this.context}})}},{key:"notifyApplicationBeforeUpdate",value:function(e,t,n){return s("ajax:before-update",{target:this.triggerEl,detail:{context:this.context,data:e,responseCode:t,xhr:n}})}},{key:"notifyApplicationRequestSuccess",value:function(e,t,n){return s("ajax:request-success",{target:this.triggerEl,detail:{context:this.context,data:e,responseCode:t,xhr:n}})}},{key:"notifyApplicationRequestError",value:function(e,t,n){return s("ajax:request-error",{target:this.triggerEl,detail:{context:this.context,message:e,responseCode:t,xhr:n}})}},{key:"notifyApplicationRequestComplete",value:function(e,t,n){return s("ajax:request-complete",{target:this.triggerEl,detail:{context:this.context,data:e,responseCode:t,xhr:n}})}},{key:"notifyApplicationBeforeValidate",value:function(e,t){return s("ajax:before-validate",{target:this.triggerEl,detail:{context:this.context,message:e,fields:t}})}},{key:"notifyApplicationBeforeReplace",value:function(e){return s("ajax:before-replace",{target:e})}},{key:"notifyApplicationBeforeSend",value:function(){return s("ajax:before-send",{target:window,detail:{context:this.context}})}},{key:"notifyApplicationUpdateComplete",value:function(e,t,n){return s("ajax:update-complete",{target:window,detail:{context:this.context,data:e,responseCode:t,xhr:n}})}},{key:"notifyApplicationFieldInvalid",value:function(e,t,n,r){return s("ajax:invalid-field",{target:window,detail:{element:e,fieldName:t,errorMsg:n,isFirst:r}})}},{key:"notifyApplicationConfirmMessage",value:function(e,t){return s("ajax:confirm-message",{target:window,detail:{message:e,promise:t}})}},{key:"notifyApplicationErrorMessage",value:function(e){return s("ajax:error-message",{target:window,detail:{message:e}})}},{key:"notifyApplicationCustomEvent",value:function(e,t){return s(e,{target:this.el,detail:t})}},{key:"requestStarted",value:function(){this.markAsProgress(!0),this.toggleLoadingElement(!0),this.options.progressBar&&this.showProgressBarAfterDelay(),this.actions.invoke("start",[this.request.xhr])}},{key:"requestProgressed",value:function(e){this.promise.notify(e)}},{key:"requestCompletedWithResponse",value:function(e,t){this.actions.invoke("success",[e,t,this.request.xhr]),this.actions.invoke("complete",[e,t,this.request.xhr]),this.promise.resolve(e,t,this.request.xhr)}},{key:"requestFailedWithStatusCode",value:function(e,t){this.actions.invoke("error",[t,e,this.request.xhr]),this.actions.invoke("complete",[t,e,this.request.xhr]),this.promise.reject(t,e,this.request.xhr)}},{key:"requestFinished",value:function(){this.markAsProgress(!1),this.toggleLoadingElement(!1),this.options.progressBar&&this.hideProgressBar()}},{key:"initOtherElements",value:function(){"string"==typeof this.options.form?this.formEl=document.querySelector(this.options.form):this.options.form?this.formEl=this.options.form:this.formEl=this.el&&this.el!==document?this.el.closest("form"):null,this.triggerEl=this.formEl?this.formEl:this.el,this.partialEl=this.el&&this.el!==document?this.el.closest("[data-ajax-partial]"):null,this.loadingEl="string"==typeof this.options.loading?document.querySelector(this.options.loading):this.options.loading}},{key:"preprocessOptions",value:function(){void 0===this.options.partial&&this.partialEl&&void 0!==this.partialEl.dataset.ajaxPartial&&(this.options.partial=this.partialEl.dataset.ajaxPartial||!0)}},{key:"validateClientSideForm",value:function(){return!(this.options.browserValidate&&"function"==typeof document.createElement("input").reportValidity&&this.formEl&&!this.formEl.checkValidity()&&(this.formEl.reportValidity(),1))}},{key:"toggleLoadingElement",value:function(e){this.loadingEl&&("function"==typeof this.loadingEl.show&&"function"==typeof this.loadingEl.hide?e?this.loadingEl.show():this.loadingEl.hide():this.loadingEl.style.display=e?"block":"none")}},{key:"showProgressBarAfterDelay",value:function(){this.progressBar.setValue(0),this.progressBarTimeout=window.setTimeout(this.showProgressBar,this.options.progressBarDelay)}},{key:"hideProgressBar",value:function(){this.progressBar.setValue(100),this.progressBar.hide(),null!=this.progressBarTimeout&&(window.clearTimeout(this.progressBarTimeout),delete this.progressBarTimeout)}},{key:"markAsProgress",value:function(e){e?(document.documentElement.setAttribute("data-ajax-progress",""),this.formEl&&this.formEl.setAttribute("data-ajax-progress",this.handler)):(document.documentElement.removeAttribute("data-ajax-progress"),this.formEl&&this.formEl.removeAttribute("data-ajax-progress"))}},{key:"wrapInAsyncPromise",value:function(e){return new Promise((function(t,n,r){e.fail((function(e){n(e)})).done((function(e){t(e)})),r((function(){e.abort()}))}))}}])&&ye(t.prototype,n),r&&ye(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function me(e){return me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},me(e)}function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}window.oc||(window.oc={}),window.oc.AjaxRequest||(window.oc.AjaxRequest=ve,window.oc.AssetManager=n,window.oc.ajax=ve.send,window.oc.request||(window.oc.request=ve.sendElement));var be=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"paramToObj",value:function(e,t){if(void 0===t&&(t=""),"object"===me(t))return t;"{"!==t.charAt(0)&&(t="{"+t+"}");try{return this.parseJSON(t)}catch(t){throw new Error("Error parsing the "+e+" attribute value. "+t)}}},{key:"parseJSON",value:function(t){return JSON.parse((new e).parseString(t))}}],(n=[{key:"parseString",value:function(e){if(!(e=e.trim()).length)throw new Error("Broken JSON object.");for(var t="";e&&","===e[0];)e=e.substr(1);if('"'===e[0]||"'"===e[0]){if(e[e.length-1]!==e[0])throw new Error("Invalid string JSON object.");for(var n='"',r=1;r<e.length;r++)if("\\"===e[r])"'"===e[r+1]||(n+=e[r]),n+=e[r+1],r++;else{if(e[r]===e[0])return n+='"';'"'===e[r]?n+='\\"':n+=e[r]}throw new Error("Invalid string JSON object.")}if("true"===e||"false"===e)return e;if("null"===e)return"null";var o=parseFloat(e);if(!isNaN(o))return o.toString();if("{"===e[0]){var i="needKey";for(t="{",r=1;r<e.length;r++)if(!this.isBlankChar(e[r]))if("needKey"!==i||'"'!==e[r]&&"'"!==e[r]){if("needKey"===i&&this.canBeKeyHead(e[r])){var a;t+='"',t+=a=this.parseKey(e,r),t+='"',r+=a.length-1,i="afterKey"}else if("afterKey"===i&&":"===e[r])t+=":",i=":";else if(":"===i)r=r+(n=this.getBody(e,r)).originLength-1,t+=this.parseString(n.body),i="afterBody";else if("afterBody"===i||"needKey"===i){for(var s=r;","===e[s]||this.isBlankChar(e[s]);)s++;if("}"===e[s]&&s===e.length-1){for(;","===t[t.length-1];)t=t.substr(0,t.length-1);return t+="}"}s!==r&&"{"!==t&&(t+=",",i="needKey",r=s-1)}}else t+='"'+(a=this.parseKey(e,r+1,e[r]))+'"',r+=a.length,r+=1,i="afterKey";throw new Error("Broken JSON object near "+t)}if("["===e[0]){for(t="[",i="needBody",r=1;r<e.length;r++)if(" "!==e[r]&&"\n"!==e[r]&&"\t"!==e[r])if("needBody"===i){if(","===e[r]){t+="null,";continue}if("]"===e[r]&&r===e.length-1)return","===t[t.length-1]&&(t=t.substr(0,t.length-1)),t+="]";r=r+(n=this.getBody(e,r)).originLength-1,t+=this.parseString(n.body),i="afterBody"}else if("afterBody"===i)if(","===e[r])for(t+=",",i="needBody";","===e[r+1]||this.isBlankChar(e[r+1]);)","===e[r+1]&&(t+="null,"),r++;else if("]"===e[r]&&r===e.length-1)return t+="]";throw new Error("Broken JSON array near "+t)}}},{key:"parseKey",value:function(e,t,n){for(var r="",o=t;o<e.length;o++){if(n&&n===e[o])return r;if(!n&&(" "===e[o]||":"===e[o]))return r;r+=e[o],"\\"===e[o]&&o+1<e.length&&(r+=e[o+1],o++)}throw new Error("Broken JSON syntax near "+r)}},{key:"getBody",value:function(e,t){if('"'===e[t]||"'"===e[t]){for(var n=e[t],r=t+1;r<e.length;r++)if("\\"===e[r])n+=e[r],r+1<e.length&&(n+=e[r+1]),r++;else{if(e[r]===e[t])return{originLength:(n+=e[t]).length,body:n};n+=e[r]}throw new Error("Broken JSON string body near "+n)}if("t"===e[t]){if(e.indexOf("true",t)===t)return{originLength:"true".length,body:"true"};throw new Error("Broken JSON boolean body near "+e.substr(0,t+10))}if("f"===e[t]){if(e.indexOf("f",t)===t)return{originLength:"false".length,body:"false"};throw new Error("Broken JSON boolean body near "+e.substr(0,t+10))}if("n"===e[t]){if(e.indexOf("null",t)===t)return{originLength:"null".length,body:"null"};throw new Error("Broken JSON boolean body near "+e.substr(0,t+10))}if("-"===e[t]||"+"===e[t]||"."===e[t]||e[t]>="0"&&e[t]<="9"){for(n="",r=t;r<e.length;r++){if(!("-"===e[r]||"+"===e[r]||"."===e[r]||e[r]>="0"&&e[r]<="9"))return{originLength:n.length,body:n};n+=e[r]}throw new Error("Broken JSON number body near "+n)}if("{"===e[t]||"["===e[t]){var o=[e[t]];for(n=e[t],r=t+1;r<e.length;r++){if(n+=e[r],"\\"===e[r])r+1<e.length&&(n+=e[r+1]),r++;else if('"'===e[r])'"'===o[o.length-1]?o.pop():"'"!==o[o.length-1]&&o.push(e[r]);else if("'"===e[r])"'"===o[o.length-1]?o.pop():'"'!==o[o.length-1]&&o.push(e[r]);else if('"'!==o[o.length-1]&&"'"!==o[o.length-1])if("{"===e[r])o.push("{");else if("}"===e[r]){if("{"!==o[o.length-1])throw new Error("Broken JSON "+("{"===e[t]?"object":"array")+" body near "+n);o.pop()}else if("["===e[r])o.push("[");else if("]"===e[r]){if("["!==o[o.length-1])throw new Error("Broken JSON "+("{"===e[t]?"object":"array")+" body near "+n);o.pop()}if(!o.length)return{originLength:r-t,body:n}}throw new Error("Broken JSON "+("{"===e[t]?"object":"array")+" body near "+n)}throw new Error("Broken JSON body near "+e.substr(t-5>=0?t-5:0,50))}},{key:"canBeKeyHead",value:function(e){return"\\"!==e[0]&&(e[0]>="a"&&e[0]<="z"||e[0]>="A"&&e[0]<="Z"||"_"===e[0]||e[0]>="0"&&e[0]<="9"||"$"===e[0]||e.charCodeAt(0)>255)}},{key:"isBlankChar",value:function(e){return" "===e||"\n"===e||"\t"===e}}])&&ge(t.prototype,n),r&&ge(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(n),!0).forEach((function(t){Ee(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Oe=function(){function e(t,n,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=r||{},this.ogElement=t,this.element=this.findElement(t),this.element?(this.assignAsEval("beforeUpdateFunc","requestBeforeUpdate"),this.assignAsEval("afterUpdateFunc","requestAfterUpdate"),this.assignAsEval("successFunc","requestSuccess"),this.assignAsEval("errorFunc","requestError"),this.assignAsEval("cancelFunc","requestCancel"),this.assignAsEval("completeFunc","requestComplete"),this.assignAsData("progressBar","requestProgressBar"),this.assignAsData("confirm","requestConfirm"),this.assignAsData("redirect","requestRedirect"),this.assignAsData("loading","requestLoading"),this.assignAsData("form","requestForm"),this.assignAsData("url","requestUrl"),this.assignAsData("bulk","requestBulk",{emptyAsTrue:!0}),this.assignAsData("files","requestFiles",{emptyAsTrue:!0}),this.assignAsData("flash","requestFlash",{emptyAsTrue:!0}),this.assignAsData("download","requestDownload",{emptyAsTrue:!0}),this.assignAsData("update","requestUpdate",{parseJson:!0}),this.assignAsData("query","requestQuery",{parseJson:!0}),this.assignAsData("browserTarget","browserTarget"),this.assignAsData("browserValidate","browserValidate",{emptyAsTrue:!0}),this.assignAsMetaData("update","ajaxRequestUpdate",{parseJson:!0,mergeValue:!0}),this.assignRequestData(),n||(n=this.getHandlerName()),ve.sendElement(this.element,n,this.options)):ve.send(n,this.options)}var t,n,r;return t=e,n=[{key:"findElement",value:function(e){if(!e||e===document)return null;if(e.matches("[data-request]"))return e;var t=e.closest("[data-request]");return t||e}},{key:"getHandlerName",value:function(){return this.element.dataset.dataRequest?this.element.dataset.dataRequest:this.element.getAttribute("data-request")}},{key:"assignAsEval",value:function(e,t){var n;void 0===this.options[e]&&(n=this.element.dataset[t]?this.element.dataset[t]:this.element.getAttribute("data-"+je(t)))&&(this.options[e]=function(e,t){return new Function("data",n).apply(e,[t])})}},{key:"assignAsData",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.parseJson,i=void 0!==o&&o,a=r.emptyAsTrue,s=void 0!==a&&a;void 0===this.options[e]&&null!==(n=this.element.dataset[t]?this.element.dataset[t]:this.element.getAttribute("data-"+je(t)))&&(this.options[e]=i?be.paramToObj("data-"+je(t),n):this.castAttrToOption(n,s))}},{key:"assignAsMetaData",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.mergeValue,o=void 0===r||r,i=n.parseJson,a=void 0!==i&&i,s=n.emptyAsTrue,u=void 0!==s&&s,l=document.documentElement.querySelector('head meta[name="'+je(t)+'"]');if(l){var c=l.getAttribute("content");c=a?be.paramToObj(je(t),c):this.castAttrToOption(c,u),this.options[e]=o?we(we({},this.options[e]||{}),c):c}}},{key:"castAttrToOption",value:function(e,t){return!(!t||""!==e)||"true"===e||"1"===e||"false"!==e&&"0"!==e&&e}},{key:"assignRequestData",value:function(){var e={};this.options.data&&Object.assign(e,this.options.data);var t=this.ogElement.getAttribute("data-request-data");t&&Object.assign(e,be.paramToObj("data-request-data",t)),function(e,t){var n=[];if(!e.parentNode)return n;for(var r=e.parentNode.closest(t);r;)n.push(r),r=r.parentNode.closest(t);return n}(this.ogElement,"[data-request-data]").reverse().forEach((function(t){Object.assign(e,be.paramToObj("data-request-data",t.getAttribute("data-request-data")))})),this.options.data=e}}],r=[{key:"fromElement",value:function(t,n,r){return"string"==typeof t&&(t=document.querySelector(t)),new e(t,n,r)}}],n&&Ae(t.prototype,n),r&&Ae(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function je(e){return e.replace(/[A-Z]/g,(function(e){return"-".concat(e.toLowerCase())}))}function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Se=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.started=!1,this.documentVisible=!0}var t,n,r;return t=e,(n=[{key:"start",value:function(){var e=this;this.started||(window.onbeforeunload=this.documentOnBeforeUnload,addEventListener("DOMContentLoaded",(function(){return e.render()})),addEventListener("page:updated",(function(){return e.render()})),addEventListener("ajax:update-complete",(function(){return e.render()})),addEventListener("visibilitychange",(function(){return e.documentOnVisibilityChange()})),A.on(document,"submit","[data-request]",this.documentOnSubmit),A.on(document,"input","input[data-request][data-track-input]",this.documentOnKeyup),A.on(document,"change","select[data-request], input[type=radio][data-request], input[type=checkbox][data-request], input[type=file][data-request]",this.documentOnChange),A.on(document,"keydown","input[type=text][data-request], input[type=submit][data-request], input[type=password][data-request]",this.documentOnKeydown),A.on(document,"click","a[data-request], button[data-request], input[type=button][data-request], input[type=submit][data-request]",this.documentOnClick),this.started=!0)}},{key:"stop",value:function(){this.started&&(this.started=!1)}},{key:"render",value:function(e){A.dispatch("before-render"),A.dispatch("render"),dispatchEvent(new Event("resize")),this.documentOnRender(e)}},{key:"documentOnVisibilityChange",value:function(e){this.documentVisible=!document.hidden,this.documentVisible&&this.documentOnRender()}},{key:"documentOnRender",value:function(e){this.documentVisible&&document.querySelectorAll("[data-auto-submit]").forEach((function(e){var t=e.dataset.autoSubmit||0;e.removeAttribute("data-auto-submit"),setTimeout((function(){Oe.fromElement(e)}),t)}))}},{key:"documentOnSubmit",value:function(e){e.preventDefault(),Oe.fromElement(e.target)}},{key:"documentOnClick",value:function(e){e.preventDefault(),Oe.fromElement(e.target)}},{key:"documentOnChange",value:function(e){Oe.fromElement(e.target)}},{key:"documentOnKeyup",value:function(e){var t=e.target,n=t.dataset.ocLastValue;if(-1!==["email","number","password","search","text"].indexOf(t.type)&&(void 0===n||n!=t.value)){t.dataset.ocLastValue=t.value,void 0!==this.dataTrackInputTimer&&clearTimeout(this.dataTrackInputTimer);var r=t.getAttribute("data-track-input");r||(r=300);var o=this;this.dataTrackInputTimer=setTimeout((function(){o.lastDataTrackInputRequest&&o.lastDataTrackInputRequest.abort(),o.lastDataTrackInputRequest=Oe.fromElement(t)}),r)}}},{key:"documentOnKeydown",value:function(e){"Enter"===e.key&&(e.preventDefault(),void 0!==this.dataTrackInputTimer&&clearTimeout(this.dataTrackInputTimer),Oe.fromElement(e.target))}},{key:"documentOnBeforeUnload",value:function(e){window.ocUnloading=!0}}])&&xe(t.prototype,n),r&&xe(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Te(e){return Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Te(e)}function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Be=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,n=[{key:"bind",value:function(){this.bindRequestFunc(),this.bindRenderFunc(),this.bindjQueryEvents()}},{key:"bindRequestFunc",value:function(){var e=$.fn.request;$.fn.request=function(e,t){var n="object"===Te(t)?t:{};return new Oe(this.get(0),e,n)},$.fn.request.Constructor=Oe,$.request=function(e,t){return $(document).request(e,t)},$.fn.request.noConflict=function(){return $.fn.request=e,this}}},{key:"bindRenderFunc",value:function(){$.fn.render=function(e){$(document).on("render",e)}}},{key:"bindjQueryEvents",value:function(){this.migratejQueryEvent(document,"ajax:setup","ajaxSetup",["context"]),this.migratejQueryEvent(document,"ajax:promise","ajaxPromise",["context"]),this.migratejQueryEvent(document,"ajax:fail","ajaxFail",["context","data","responseCode","xhr"]),this.migratejQueryEvent(document,"ajax:done","ajaxDone",["context","data","responseCode","xhr"]),this.migratejQueryEvent(document,"ajax:always","ajaxAlways",["context","data","responseCode","xhr"]),this.migratejQueryEvent(document,"ajax:before-redirect","ajaxRedirect"),this.migratejQueryEvent(document,"ajax:update","ajaxUpdate",["context","data","responseCode","xhr"]),this.migratejQueryEvent(document,"ajax:before-replace","ajaxBeforeReplace"),this.migratejQueryEvent(document,"ajax:before-request","oc.beforeRequest",["context"]),this.migratejQueryEvent(document,"ajax:before-update","ajaxBeforeUpdate",["context","data","responseCode","xhr"]),this.migratejQueryEvent(document,"ajax:request-success","ajaxSuccess",["context","data","responseCode","xhr"]),this.migratejQueryEvent(document,"ajax:request-complete","ajaxComplete",["context","data","responseCode","xhr"]),this.migratejQueryEvent(document,"ajax:request-error","ajaxError",["context","message","responseCode","xhr"]),this.migratejQueryEvent(document,"ajax:before-validate","ajaxValidation",["context","message","fields"]),this.migratejQueryEvent(window,"ajax:before-send","ajaxBeforeSend",["context"]),this.migratejQueryEvent(window,"ajax:update-complete","ajaxUpdateComplete",["context","data","responseCode","xhr"]),this.migratejQueryEvent(window,"ajax:invalid-field","ajaxInvalidField",["element","fieldName","errorMsg","isFirst"]),this.migratejQueryEvent(window,"ajax:confirm-message","ajaxConfirmMessage",["message","promise"]),this.migratejQueryEvent(window,"ajax:error-message","ajaxErrorMessage",["message"]),this.migratejQueryAttachData(document,"ajax:setup","a[data-request], button[data-request], form[data-request], a[data-handler], button[data-handler]")}},{key:"migratejQueryEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=this;$(e).on(t,(function(e){o.triggerjQueryEvent(e.originalEvent,n,r)}))}},{key:"triggerjQueryEvent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=$.Event(t),o=this.buildDetailArgs(e,n);$(e.target).trigger(r,o),r.isDefaultPrevented()&&e.preventDefault()}},{key:"buildDetailArgs",value:function(e,t){var n=[];return t.forEach((function(t){n.push(e.detail[t])})),n}},{key:"migratejQueryAttachData",value:function(e,t,n){$(e).on(t,n,(function(e){var t=$(this).data("request-data");if(t){var n=e.detail.context.options;t.constructor==={}.constructor?Object.assign(n.data,t):"string"==typeof t&&Object.assign(n.data,be.paramToObj("request-data",t))}}))}}],n&&Ce(t.prototype,n),r&&Ce(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),qe=new Se;const Pe={controller:qe,parseJSON:be.parseJSON,serializeJSON:oe.serializeJSON,requestElement:Oe.fromElement,start:function(){qe.start(),window.jQuery&&(new Be).bind()},stop:function(){qe.stop()}};function Re(e){return Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Re(e)}function Fe(e){return function(e){if(Array.isArray(e))return Le(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Le(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}window.oc||(window.oc={}),window.oc.AjaxFramework||(window.oc.AjaxFramework=Pe,window.oc.request=Pe.requestElement,window.oc.parseJSON=Pe.parseJSON,window.oc.serializeJSON=Pe.serializeJSON,window.oc.Events=A,"function"==typeof define&&e.amdO||"object"==("undefined"==typeof exports?"undefined":Re(exports))||Pe.start());var Me,De=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"submit",value:function(e){var t=e.closest("form");t&&(t.querySelectorAll("[data-validate-for]").forEach((function(e){e.classList.remove("oc-visible")})),t.querySelectorAll("[data-validate-error]").forEach((function(e){e.classList.remove("oc-visible")})))}},{key:"validate",value:function(e,t,n,r){var o=e.closest("form"),i=[];if(o){for(var a in t){var s=t[a];i=[].concat(Fe(i),Fe(s));var u=o.querySelector('[data-validate-for="'+a+'"]');u&&(u.innerHTML&&!u.dataset.emptyMode||(u.dataset.emptyMode=!0,u.innerHTML=s.join(", ")),u.classList.add("oc-visible"))}var l=o.querySelector("[data-validate-error]");if(l){l.classList.add("oc-visible");var c=l.querySelectorAll("[data-message]");if(c.length>0){var f=c[0];i.forEach((function(e){var t=f.cloneNode(!0);t.innerHTML=e,f.parentNode.insertBefore(t,f.nextSibling)})),c.forEach((function(e){e.remove()}))}else l.innerHTML=n}r||A.one(o,"ajax:request-error",(function(e){e.preventDefault()}))}}}])&&Ie(t.prototype,n),r&&Ie(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ue,Ve,Je,_e,Ke=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stylesheetElement=this.createStylesheetElement()}var t,n,r;return t=e,r=[{key:"defaultCSS",get:function(){return u(Me||(e=["\n        .oc-attach-loader:after {\n            content: '';\n            display: inline-block;\n            vertical-align: middle;\n            margin-left: .4em;\n            height: 1em;\n            width: 1em;\n            animation: oc-rotate-loader 0.8s infinite linear;\n            border: .2em solid currentColor;\n            border-right-color: transparent;\n            border-radius: 50%;\n            opacity: .5;\n        }\n\n        @keyframes oc-rotate-loader {\n            0%    { transform: rotate(0deg); }\n            100%  { transform: rotate(360deg); }\n        }\n    "],t||(t=e.slice(0)),Me=Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))));var e,t}},{key:"attachLoader",get:function(){return{show:function(t){(new e).show(He(t))},hide:function(t){(new e).hide(He(t))},hideAll:function(){(new e).hideAll()}}}}],(n=[{key:"show",value:function(e){if(this.installStylesheetElement(),Qe(e)){var t=document.createElement("span");t.className="oc-attach-loader is-inline",e.parentNode.insertBefore(t,e.nextSibling)}else e.classList.add("oc-attach-loader"),e.disabled=!0}},{key:"hide",value:function(e){Qe(e)?e.nextSibling.classList.contains("oc-attach-loader")&&e.nextSibling.remove():(e.classList.remove("oc-attach-loader"),e.disabled=!1)}},{key:"hideAll",value:function(){document.querySelectorAll(".oc-attach-loader.is-inline").forEach((function(e){e.remove()})),document.querySelectorAll(".oc-attach-loader").forEach((function(e){e.classList.remove("oc-attach-loader"),e.disabled=!1}))}},{key:"showForm",value:function(e){if(void 0!==e.dataset.attachLoading&&this.show(e),e.matches("form")){var t=this;e.querySelectorAll("[data-attach-loading]").forEach((function(e){Qe(e)||t.show(e)}))}}},{key:"hideForm",value:function(e){if(void 0!==e.dataset.attachLoading&&this.hide(e),e.matches("form")){var t=this;e.querySelectorAll("[data-attach-loading]").forEach((function(e){Qe(e)||t.hide(e)}))}}},{key:"installStylesheetElement",value:function(){e.stylesheetReady||(document.head.insertBefore(this.stylesheetElement,document.head.firstChild),e.stylesheetReady=!0)}},{key:"createStylesheetElement",value:function(){var t=document.createElement("style");return t.textContent=e.defaultCSS,t}}])&&Ne(t.prototype,n),r&&Ne(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Qe(e){return["input","select","textarea"].includes((e.tagName||"").toLowerCase())}function He(e){if("string"==typeof e&&(e=document.querySelector(e)),!e)throw new Error("Invalid element for attach loader.");return e}function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(n),!0).forEach((function(t){We(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function We(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Je=!1,(Ve="stylesheetReady")in(Ue=Ke)?Object.defineProperty(Ue,Ve,{value:Je,enumerable:!0,configurable:!0,writable:!0}):Ue[Ve]=Je;var Ge=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stylesheetElement=this.createStylesheetElement()}var t,n,r;return t=e,n=[{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.installStylesheetElement();var t=e.message,n=void 0===t?"":t,r=e.type,o=void 0===r?"info":r,i=e.target,a=void 0===i?null:i,s=e.interval,u=void 0===s?5:s;e.text&&(n=e.text),e.class&&(o=e.class),a&&a.removeAttribute("data-control"),"error"===o&&this.deleteFlashMessages();var l,c=this.createFlashElement(n,o);function f(){clearInterval(l),c.removeEventListener("click",h),c.removeEventListener("extras:flash-remove",f),c.querySelector(".flash-close").removeEventListener("click",f),c.classList.remove("flash-show"),setTimeout((function(){c.remove()}),1e3)}function h(){clearInterval(l)}document.body.appendChild(c),setTimeout((function(){c.classList.add("flash-show")}),100),c.addEventListener("click",h),c.addEventListener("extras:flash-remove",f),c.querySelector(".flash-close").addEventListener("click",f),u&&0!==u&&(l=setTimeout(f,1e3*u))}},{key:"render",value:function(){var e=this;document.querySelectorAll("[data-control=flash-message]").forEach((function(t){e.show(Xe(Xe({},t.dataset),{},{target:t,message:t.innerHTML})),t.remove()}))}},{key:"deleteFlashMessages",value:function(){document.querySelectorAll(".oc-flash-message").forEach((function(e){e.dispatchEvent(new Event("extras:flash-remove"))}))}},{key:"createFlashElement",value:function(e,t){var n=document.createElement("div");return n.className="oc-flash-message "+t,n.innerHTML="<span>"+e+'</span><a class="flash-close"></a>',n}},{key:"installStylesheetElement",value:function(){e.stylesheetReady||(document.head.insertBefore(this.stylesheetElement,document.head.firstChild),e.stylesheetReady=!0)}},{key:"createStylesheetElement",value:function(){var t=document.createElement("style");return t.textContent=e.defaultCSS,t}}],r=[{key:"defaultCSS",get:function(){return u(_e||(e=["\n        .oc-flash-message {\n            position: fixed;\n            z-index: 10300;\n            width: 500px;\n            left: 50%;\n            top: 50px;\n            margin-left: -250px;\n            color: #fff;\n            font-size: 1rem;\n            padding: 10px 30px 10px 15px;\n            border-radius: 5px;\n\n            opacity: 0;\n            transition: all 0.5s, width 0s;\n            transform: scale(0.9);\n        }\n        .oc-flash-message.flash-show {\n            opacity: 1;\n            transform: scale(1);\n        }\n        .oc-flash-message.success {\n            background: #86cB43;\n        }\n        .oc-flash-message.error {\n            background: #cc3300;\n        }\n        .oc-flash-message.warning {\n            background: #f0ad4e;\n        }\n        .oc-flash-message.info {\n            background: #5fb6f5;\n        }\n        .oc-flash-message a.flash-close {\n            box-sizing: content-box;\n            width: 1em;\n            height: 1em;\n            padding: .25em .25em;\n            background: transparent url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23FFF'%3e%3cpath d='M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z'/%3e%3c/svg%3e\") center/1em auto no-repeat;\n            border: 0;\n            border-radius: .25rem;\n            opacity: .5;\n            text-decoration: none;\n            position: absolute;\n            right: .7rem;\n            top: .7rem;\n            cursor: pointer;\n        }\n        .oc-flash-message a.flash-close:hover,\n        .oc-flash-message a.flash-close:focus {\n            opacity: 1;\n        }\n        html[data-turbo-preview] .oc-flash-message {\n            opacity: 0;\n        }\n        @media (max-width: 768px) {\n            .oc-flash-message {\n                left: 1rem;\n                right: 1rem;\n                top: 1rem;\n                margin-left: 0;\n                width: auto;\n            }\n        }\n    "],t||(t=e.slice(0)),_e=Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))));var e,t}},{key:"flashMsg",value:function(t){return(new e).show(t)}}],n&&ze(t.prototype,n),r&&ze(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}We(Ge,"stylesheetReady",!1);var Ye=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.started=!1,this.enableProgressBar=function(e){var t=e.detail.context.options;null===t.progressBar&&(t.progressBar=!0)},this.showAttachLoader=function(e){t.attachLoader.showForm(e.target)},this.hideAttachLoader=function(e){t.attachLoader.hideForm(e.target)},this.hideAllAttachLoaders=function(e){t.attachLoader.hideAll()},this.validatorSubmit=function(e){t.validator.submit(e.target)},this.validatorValidate=function(e){t.validator.validate(e.target,e.detail.fields,e.detail.message,et(e.detail.context.options.flash,"validate"))},this.flashMessageBind=function(e){var n=e.detail.context.options,r=t;n.flash&&(n.handleErrorMessage=function(e){(e&&et(n.flash,"error")||et(n.flash,"validate"))&&r.flashMessage.show({message:e,type:"error"})},n.handleFlashMessage=function(e,t){e&&et(n.flash,t)&&r.flashMessage.show({message:e,type:t})})},this.flashMessageRender=function(e){t.flashMessage.render()},this.handleBrowserRedirect=function(e){if(!e.defaultPrevented)if(oc.useTurbo&&oc.useTurbo()){var t=oc.AjaxTurbo.controller.getLastVisitUrl();t&&(e.preventDefault(),oc.visit(t))}else{var n=function(){if(!document.referrer)return null;try{var e=new URL(document.referrer);if(e.origin!==location.origin)return null;var t=localStorage.getItem("ocPushStateReferrer");return t&&0===t.indexOf(e.pathname)?t:document.referrer}catch(e){}}();n&&(e.preventDefault(),location.assign(n))}}}var t,n,r;return t=e,(n=[{key:"start",value:function(){this.started||(addEventListener("ajax:setup",this.enableProgressBar),this.attachLoader=new Ke,A.on(document,"ajax:promise","form, [data-attach-loading]",this.showAttachLoader),A.on(document,"ajax:fail","form, [data-attach-loading]",this.hideAttachLoader),A.on(document,"ajax:done","form, [data-attach-loading]",this.hideAttachLoader),addEventListener("page:before-cache",this.hideAllAttachLoaders),this.validator=new De,A.on(document,"ajax:before-validate","[data-request-validate]",this.validatorValidate),A.on(document,"ajax:promise","[data-request-validate]",this.validatorSubmit),this.flashMessage=new Ge,addEventListener("render",this.flashMessageRender),addEventListener("ajax:setup",this.flashMessageBind),A.on(document,"click","[data-browser-redirect-back]",this.handleBrowserRedirect),A.on(document,"ajax:before-redirect","[data-browser-redirect-back]",this.handleBrowserRedirect),this.started=!0)}},{key:"stop",value:function(){this.started&&(removeEventListener("ajax:setup",this.enableProgressBar),this.attachLoader=null,A.off(document,"ajax:promise","form, [data-attach-loading]",this.showAttachLoader),A.off(document,"ajax:fail","form, [data-attach-loading]",this.hideAttachLoader),A.off(document,"ajax:done","form, [data-attach-loading]",this.hideAttachLoader),removeEventListener("page:before-cache",this.hideAllAttachLoaders),this.validator=null,A.off(document,"ajax:before-validate","[data-request-validate]",this.validatorValidate),A.off(document,"ajax:promise","[data-request-validate]",this.validatorSubmit),this.flashMessage=null,removeEventListener("render",this.flashMessageRender),removeEventListener("ajax:setup",this.flashMessageBind),A.off(document,"click","[data-browser-redirect-back]",this.handleBrowserRedirect),A.off(document,"ajax:before-redirect","[data-browser-redirect-back]",this.handleBrowserRedirect),this.started=!1)}}])&&Ze(t.prototype,n),r&&Ze(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function et(e,t){if(!0===e&&"validate"!==t)return!0;if("string"!=typeof e)return!1;if("*"===e)return!0;var n=!1;return e.split(",").forEach((function(e){e.trim()===t&&(n=!0)})),n}function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var nt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"bind",value:function(){void 0===$.oc&&($.oc={}),$.oc.flashMsg=window.oc.flashMsg,$.oc.stripeLoadIndicator=window.oc.progressBar}}])&&tt(t.prototype,n),r&&tt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),rt=new Ye;const ot={controller:rt,flashMsg:Ge.flashMsg,progressBar:ce.progressBar,attachLoader:Ke.attachLoader,start:function(){rt.start(),window.jQuery&&(new nt).bind()},stop:function(){rt.stop()}};function it(e){return it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},it(e)}function at(e){return function(e){if(Array.isArray(e))return st(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return st(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return st(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function st(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}window.oc||(window.oc={}),window.oc.AjaxExtras||(window.oc.AjaxExtras=ot,window.oc.flashMsg=ot.flashMsg,window.oc.progressBar=ot.progressBar,window.oc.attachLoader=ot.attachLoader,"function"==typeof define&&e.amdO||"object"==("undefined"==typeof exports?"undefined":it(exports))||ot.start());var lt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.context=t}var t,n,r;return t=e,n=[{key:"application",get:function(){return this.context.application}},{key:"scope",get:function(){return this.context.scope}},{key:"element",get:function(){return this.scope.element}},{key:"config",get:function(){return this.scope.element.dataset}},{key:"identifier",get:function(){return this.scope.identifier}},{key:"init",value:function(){}},{key:"connect",value:function(){}},{key:"disconnect",value:function(){}},{key:"initBefore",value:function(){this.proxiedEvents={},this.proxiedMethods={}}},{key:"initAfter",value:function(){}},{key:"connectBefore",value:function(){}},{key:"connectAfter",value:function(){}},{key:"disconnectBefore",value:function(){}},{key:"disconnectAfter",value:function(){for(var e in this.proxiedEvents)this.forget.apply(this,at(this.proxiedEvents[e])),delete this.proxiedEvents[e];for(var t in this.proxiedMethods)this.proxiedMethods[t]=void 0}},{key:"listen",value:function(t,n,r,o){"string"==typeof n?oc.Events.on(this.element,t,n,this.proxy(r),o):n instanceof Element?oc.Events.on(n,t,this.proxy(r),o):oc.Events.on(this.element,t,this.proxy(n),r),e.proxyCounter++,this.proxiedEvents[e.proxyCounter]=arguments}},{key:"forget",value:function(e,t,n,r){"string"==typeof t?oc.Events.off(this.element,e,t,this.proxy(n),r):t instanceof Element?oc.Events.off(t,e,this.proxy(n),r):oc.Events.off(this.element,e,this.proxy(t),n);var o=function(e,t){if(e.length===t.length)for(var n=0;n<e.length;n++)if(e[n]===t[n])return!0;return!1};for(var i in this.proxiedEvents)o(arguments,this.proxiedEvents[i])&&delete this.proxiedEvents[i]}},{key:"dispatch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.target,r=void 0===n?this.element:n,o=t.detail,i=void 0===o?{}:o,a=t.prefix,s=void 0===a?this.identifier:a,u=t.bubbles,l=void 0===u||u,c=t.cancelable,f=void 0===c||c,h=s?"".concat(s,":").concat(e):e,d=new CustomEvent(h,{detail:i,bubbles:l,cancelable:f});return r.dispatchEvent(d),d}},{key:"proxy",value:function(t){return void 0===t.ocProxyId&&(e.proxyCounter++,t.ocProxyId=e.proxyCounter),void 0!==this.proxiedMethods[t.ocProxyId]||(this.proxiedMethods[t.ocProxyId]=t.bind(this)),this.proxiedMethods[t.ocProxyId]}}],r=[{key:"shouldLoad",get:function(){return!0}},{key:"afterLoad",value:function(e,t){}}],n&&ut(t.prototype,n),r&&ut(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ct(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ft(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ft(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function ft(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ht(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(lt,"proxyCounter",0);var dt=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eventTarget=t,this.eventName=n,this.eventOptions=r,this.unorderedBindings=new Set}var t,n,r;return t=e,(n=[{key:"connect",value:function(){this.eventTarget.addEventListener(this.eventName,this,this.eventOptions)}},{key:"disconnect",value:function(){this.eventTarget.removeEventListener(this.eventName,this,this.eventOptions)}},{key:"bindingConnected",value:function(e){this.unorderedBindings.add(e)}},{key:"bindingDisconnected",value:function(e){this.unorderedBindings.delete(e)}},{key:"handleEvent",value:function(e){var t,n=function(e){if("immediatePropagationStopped"in e)return e;var t=e.stopImmediatePropagation;return Object.assign(e,{immediatePropagationStopped:!1,stopImmediatePropagation:function(){this.immediatePropagationStopped=!0,t.call(this)}})}(e),r=ct(this.bindings);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(n.immediatePropagationStopped)break;o.handleEvent(n)}}catch(e){r.e(e)}finally{r.f()}}},{key:"hasBindings",value:function(){return this.unorderedBindings.size>0}},{key:"bindings",get:function(){return Array.from(this.unorderedBindings).sort((function(e,t){var n=e.index,r=t.index;return n<r?-1:n>r?1:0}))}}])&&ht(t.prototype,n),r&&ht(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function pt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var yt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.application=t,this.eventListenerMaps=new Map,this.started=!1}var t,n,r;return t=e,n=[{key:"start",value:function(){this.started||(this.started=!0,this.eventListeners.forEach((function(e){return e.connect()})))}},{key:"stop",value:function(){this.started&&(this.started=!1,this.eventListeners.forEach((function(e){return e.disconnect()})))}},{key:"eventListeners",get:function(){return Array.from(this.eventListenerMaps.values()).reduce((function(e,t){return e.concat(Array.from(t.values()))}),[])}},{key:"bindingConnected",value:function(e){this.fetchEventListenerForBinding(e).bindingConnected(e)}},{key:"bindingDisconnected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.fetchEventListenerForBinding(e).bindingDisconnected(e),t&&this.clearEventListenersForBinding(e)}},{key:"handleError",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.application.handleError(e,"Error ".concat(t),n)}},{key:"clearEventListenersForBinding",value:function(e){var t=this.fetchEventListenerForBinding(e);t.hasBindings()||(t.disconnect(),this.removeMappedEventListenerFor(e))}},{key:"removeMappedEventListenerFor",value:function(e){var t=e.eventTarget,n=e.eventName,r=e.eventOptions,o=this.fetchEventListenerMapForEventTarget(t),i=this.cacheKey(n,r);o.delete(i),0==o.size&&this.eventListenerMaps.delete(t)}},{key:"fetchEventListenerForBinding",value:function(e){var t=e.eventTarget,n=e.eventName,r=e.eventOptions;return this.fetchEventListener(t,n,r)}},{key:"fetchEventListener",value:function(e,t,n){var r=this.fetchEventListenerMapForEventTarget(e),o=this.cacheKey(t,n),i=r.get(o);return i||(i=this.createEventListener(e,t,n),r.set(o,i)),i}},{key:"createEventListener",value:function(e,t,n){var r=new dt(e,t,n);return this.started&&r.connect(),r}},{key:"fetchEventListenerMapForEventTarget",value:function(e){var t=this.eventListenerMaps.get(e);return t||(t=new Map,this.eventListenerMaps.set(e,t)),t}},{key:"cacheKey",value:function(e,t){var n=[e];return Object.keys(t).sort().forEach((function(e){n.push("".concat(t[e]?"":"!").concat(e))})),n.join(":")}}],n&&pt(t.prototype,n),r&&pt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var mt=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.module=t,this.scope=n,this.control=new t.controlConstructor(this);try{this.control.initBefore(),this.control.init(),this.control.initAfter()}catch(e){this.handleError(e,"initializing control")}}var t,n,r;return t=e,n=[{key:"connect",value:function(){try{this.control.connectBefore(),this.control.connect(),this.control.connectAfter()}catch(e){this.handleError(e,"connecting control")}}},{key:"refresh",value:function(){}},{key:"disconnect",value:function(){try{this.control.disconnectBefore(),this.control.disconnect(),this.control.disconnectAfter()}catch(e){this.handleError(e,"disconnecting control")}}},{key:"application",get:function(){return this.module.application}},{key:"identifier",get:function(){return this.module.identifier}},{key:"dispatcher",get:function(){return this.application.dispatcher}},{key:"element",get:function(){return this.scope.element}},{key:"parentElement",get:function(){return this.element.parentElement}},{key:"handleError",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.identifier,o=this.control,i=this.element;n=Object.assign({identifier:r,control:o,element:i},n),this.application.handleError(e,"Error ".concat(t),n)}}],n&&vt(t.prototype,n),r&&vt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var bt=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.application=t,this.definition=function(e){return{identifier:e.identifier,controlConstructor:e.controlConstructor}}(n),this.contextsByScope=new WeakMap,this.connectedContexts=new Set}var t,n,r;return t=e,(n=[{key:"identifier",get:function(){return this.definition.identifier}},{key:"controlConstructor",get:function(){return this.definition.controlConstructor}},{key:"contexts",get:function(){return Array.from(this.connectedContexts)}},{key:"connectContextForScope",value:function(e){var t=this.fetchContextForScope(e);this.connectedContexts.add(t),t.connect()}},{key:"disconnectContextForScope",value:function(e){var t=this.contextsByScope.get(e);t&&(this.connectedContexts.delete(t),t.disconnect())}},{key:"fetchContextForScope",value:function(e){var t=this.contextsByScope.get(e);return t||(t=new mt(this,e),this.contextsByScope.set(e,t)),t}}])&&gt(t.prototype,n),r&&gt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function kt(e){return function(e){if(Array.isArray(e))return wt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return wt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Et(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var At=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.identifier=n,this.containsElement=function(e){return e.closest(r.controlSelector)===r.element}}var t,n,r;return t=e,(n=[{key:"findElement",value:function(e){return this.element.matches(e)?this.element:this.queryElements(e).find(this.containsElement)}},{key:"findAllElements",value:function(e){return[].concat(kt(this.element.matches(e)?[this.element]:[]),kt(this.queryElements(e).filter(this.containsElement)))}},{key:"queryElements",value:function(e){return Array.from(this.element.querySelectorAll(e))}},{key:"controlSelector",get:function(){return e="data-control",t=this.identifier,"[".concat(e,'~="').concat(t,'"]');var e,t}},{key:"isDocumentScope",get:function(){return this.element===document.documentElement}},{key:"documentScope",get:function(){return this.isDocumentScope?this:new e(document.documentElement,this.identifier)}}])&&Et(t.prototype,n),r&&Et(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ot(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return jt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function jt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function xt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var St=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mutationObserverInit={attributes:!0,childList:!0,subtree:!0},this.element=t,this.started=!1,this.delegate=n,this.elements=new Set,this.mutationObserver=new MutationObserver((function(e){return r.processMutations(e)}))}var t,n,r;return t=e,n=[{key:"start",value:function(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,this.mutationObserverInit),this.refresh())}},{key:"pause",value:function(e){this.started&&(this.mutationObserver.disconnect(),this.started=!1),e(),this.started||(this.mutationObserver.observe(this.element,this.mutationObserverInit),this.started=!0)}},{key:"stop",value:function(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)}},{key:"refresh",value:function(){if(this.started){for(var e=new Set(this.matchElementsInTree()),t=0,n=Array.from(this.elements);t<n.length;t++){var r=n[t];e.has(r)||this.removeElement(r)}for(var o=0,i=Array.from(e);o<i.length;o++){var a=i[o];this.addElement(a)}}}},{key:"processMutations",value:function(e){if(this.started){var t,n=Ot(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.processMutation(r)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"processMutation",value:function(e){"attributes"==e.type?this.processAttributeChange(e.target,e.attributeName):"childList"==e.type&&(this.processRemovedNodes(e.removedNodes),this.processAddedNodes(e.addedNodes))}},{key:"processAttributeChange",value:function(e,t){this.elements.has(e)?this.delegate.elementAttributeChanged&&this.matchElement(e)?this.delegate.elementAttributeChanged(e,t):this.removeElement(e):this.matchElement(e)&&this.addElement(e)}},{key:"processRemovedNodes",value:function(e){for(var t=0,n=Array.from(e);t<n.length;t++){var r=n[t],o=this.elementFromNode(r);o&&this.processTree(o,this.removeElement)}}},{key:"processAddedNodes",value:function(e){for(var t=0,n=Array.from(e);t<n.length;t++){var r=n[t],o=this.elementFromNode(r);o&&this.elementIsActive(o)&&this.processTree(o,this.addElement)}}},{key:"matchElement",value:function(e){return this.delegate.matchElement(e)}},{key:"matchElementsInTree",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.element;return this.delegate.matchElementsInTree(e)}},{key:"processTree",value:function(e,t){var n,r=Ot(this.matchElementsInTree(e));try{for(r.s();!(n=r.n()).done;){var o=n.value;t.call(this,o)}}catch(e){r.e(e)}finally{r.f()}}},{key:"elementFromNode",value:function(e){if(e.nodeType==Node.ELEMENT_NODE)return e}},{key:"elementIsActive",value:function(e){return e.isConnected==this.element.isConnected&&this.element.contains(e)}},{key:"addElement",value:function(e){this.elements.has(e)||this.elementIsActive(e)&&(this.elements.add(e),this.delegate.elementMatched&&this.delegate.elementMatched(e))}},{key:"removeElement",value:function(e){this.elements.has(e)&&(this.elements.delete(e),this.delegate.elementUnmatched&&this.delegate.elementUnmatched(e))}}],n&&xt(t.prototype,n),r&&xt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ct=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.delegate=r,this.attributeName=n,this.elementObserver=new St(t,this)}var t,n,r;return t=e,(n=[{key:"element",get:function(){return this.elementObserver.element}},{key:"selector",get:function(){return"[".concat(this.attributeName,"]")}},{key:"start",value:function(){this.elementObserver.start()}},{key:"pause",value:function(e){this.elementObserver.pause(e)}},{key:"stop",value:function(){this.elementObserver.stop()}},{key:"refresh",value:function(){this.elementObserver.refresh()}},{key:"started",get:function(){return this.elementObserver.started}},{key:"matchElement",value:function(e){return e.hasAttribute(this.attributeName)}},{key:"matchElementsInTree",value:function(e){var t=this.matchElement(e)?[e]:[],n=Array.from(e.querySelectorAll(this.selector));return t.concat(n)}},{key:"elementMatched",value:function(e){this.delegate.elementMatchedAttribute&&this.delegate.elementMatchedAttribute(e,this.attributeName)}},{key:"elementUnmatched",value:function(e){this.delegate.elementUnmatchedAttribute&&this.delegate.elementUnmatchedAttribute(e,this.attributeName)}},{key:"elementAttributeChanged",value:function(e,t){this.delegate.elementAttributeValueChanged&&this.attributeName==t&&this.delegate.elementAttributeValueChanged(e,t)}}])&&Tt(t.prototype,n),r&&Tt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Bt(e,t){var n=e.get(t);return n||(n=new Set,e.set(t,n)),n}function qt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Pt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ft=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.valuesByKey=new Map}var t,n,r;return t=e,n=[{key:"keys",get:function(){return Array.from(this.valuesByKey.keys())}},{key:"values",get:function(){return Array.from(this.valuesByKey.values()).reduce((function(e,t){return e.concat(Array.from(t))}),React.createElement(V,null),[]>[])}},{key:"size",get:function(){return Array.from(this.valuesByKey.values()).reduce((function(e,t){return e+t.size}),0)}},{key:"add",value:function(e,t){!function(e,t,n){Bt(e,t).add(n)}(this.valuesByKey,e,t)}},{key:"delete",value:function(e,t){!function(e,t,n){Bt(e,t).delete(n),function(e,t){var n=e.get(t);null!=n&&0==n.size&&e.delete(t)}(e,t)}(this.valuesByKey,e,t)}},{key:"has",value:function(e,t){var n=this.valuesByKey.get(e);return null!=n&&n.has(t)}},{key:"hasKey",value:function(e){return this.valuesByKey.has(e)}},{key:"hasValue",value:function(e){return Array.from(this.valuesByKey.values()).some((function(t){return t.has(e)}))}},{key:"getValuesForKey",value:function(e){var t=this.valuesByKey.get(e);return t?Array.from(t):[]}},{key:"getKeysForValue",value:function(e){return Array.from(this.valuesByKey).filter((function(t){var n=qt(t,2);return n[0],n[1].has(e)})).map((function(e){var t=qt(e,2),n=t[0];return t[1],n}))}}],n&&Rt(t.prototype,n),r&&Rt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Lt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return It(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return It(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function It(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Mt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Dt=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.delegate=r,this.attributeObserver=new Ct(t,n,this),this.tokensByElement=new Ft}var t,n,r;return t=e,(n=[{key:"started",get:function(){return this.attributeObserver.started}},{key:"start",value:function(){this.attributeObserver.start()}},{key:"pause",value:function(e){this.attributeObserver.pause(e)}},{key:"stop",value:function(){this.attributeObserver.stop()}},{key:"refresh",value:function(){this.attributeObserver.refresh()}},{key:"element",get:function(){return this.attributeObserver.element}},{key:"attributeName",get:function(){return this.attributeObserver.attributeName}},{key:"elementMatchedAttribute",value:function(e){this.tokensMatched(this.readTokensForElement(e))}},{key:"elementAttributeValueChanged",value:function(e){var t=Lt(this.refreshTokensForElement(e),2),n=t[0],r=t[1];this.tokensUnmatched(n),this.tokensMatched(r)}},{key:"elementUnmatchedAttribute",value:function(e){this.tokensUnmatched(this.tokensByElement.getValuesForKey(e))}},{key:"tokensMatched",value:function(e){var t=this;e.forEach((function(e){return t.tokenMatched(e)}))}},{key:"tokensUnmatched",value:function(e){var t=this;e.forEach((function(e){return t.tokenUnmatched(e)}))}},{key:"tokenMatched",value:function(e){this.delegate.tokenMatched(e),this.tokensByElement.add(e.element,e)}},{key:"tokenUnmatched",value:function(e){this.delegate.tokenUnmatched(e),this.tokensByElement.delete(e.element,e)}},{key:"refreshTokensForElement",value:function(e){var t,n,r,o=this.tokensByElement.getValuesForKey(e),i=this.readTokensForElement(e),a=(t=o,n=i,r=Math.max(t.length,n.length),Array.from({length:r},(function(e,r){return[t[r],n[r]]}))).findIndex((function(e){var t=Lt(e,2);return!function(e,t){return e&&t&&e.index==t.index&&e.content==t.content}(t[0],t[1])}));return-1==a?[[],[]]:[o.slice(a),i.slice(a)]}},{key:"readTokensForElement",value:function(e){var t=this.attributeName;return function(e,t,n){return e.trim().split(/\s+/).filter((function(e){return e.length})).map((function(e,r){return{element:t,attributeName:n,content:e,index:r}}))}(e.getAttribute(t)||"",e,t)}}])&&Mt(t.prototype,n),r&&Mt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ut=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tokenListObserver=new Dt(t,n,this),this.delegate=r,this.parseResultsByToken=new WeakMap,this.valuesByTokenByElement=new WeakMap}var t,n,r;return t=e,n=[{key:"started",get:function(){return this.tokenListObserver.started}},{key:"start",value:function(){this.tokenListObserver.start()}},{key:"stop",value:function(){this.tokenListObserver.stop()}},{key:"refresh",value:function(){this.tokenListObserver.refresh()}},{key:"element",get:function(){return this.tokenListObserver.element}},{key:"attributeName",get:function(){return this.tokenListObserver.attributeName}},{key:"tokenMatched",value:function(e){var t=e.element,n=this.fetchParseResultForToken(e).value;n&&(this.fetchValuesByTokenForElement(t).set(e,n),this.delegate.elementMatchedValue(t,n))}},{key:"tokenUnmatched",value:function(e){var t=e.element,n=this.fetchParseResultForToken(e).value;n&&(this.fetchValuesByTokenForElement(t).delete(e),this.delegate.elementUnmatchedValue(t,n))}},{key:"fetchParseResultForToken",value:function(e){var t=this.parseResultsByToken.get(e);return t||(t=this.parseToken(e),this.parseResultsByToken.set(e,t)),t}},{key:"fetchValuesByTokenForElement",value:function(e){var t=this.valuesByTokenByElement.get(e);return t||(t=new Map,this.valuesByTokenByElement.set(e,t)),t}},{key:"parseToken",value:function(e){try{return{value:this.delegate.parseValueForToken(e)}}catch(e){return{error:e}}}}],n&&Nt(t.prototype,n),r&&Nt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Jt=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.delegate=n,this.valueListObserver=new Ut(this.element,this.controlAttribute,this),this.scopesByIdentifierByElement=new WeakMap,this.scopeReferenceCounts=new WeakMap}var t,n,r;return t=e,n=[{key:"start",value:function(){this.valueListObserver.start()}},{key:"stop",value:function(){this.valueListObserver.stop()}},{key:"controlAttribute",get:function(){return"data-control"}},{key:"parseValueForToken",value:function(e){var t=e.element,n=e.content,r=this.fetchScopesByIdentifierForElement(t),o=r.get(n);return o||(o=this.delegate.createScopeForElementAndIdentifier(t,n),r.set(n,o)),o}},{key:"elementMatchedValue",value:function(e,t){var n=(this.scopeReferenceCounts.get(t)||0)+1;this.scopeReferenceCounts.set(t,n),1==n&&this.delegate.scopeConnected(t)}},{key:"elementUnmatchedValue",value:function(e,t){var n=this.scopeReferenceCounts.get(t);n&&(this.scopeReferenceCounts.set(t,n-1),1==n&&this.delegate.scopeDisconnected(t))}},{key:"fetchScopesByIdentifierForElement",value:function(e){var t=this.scopesByIdentifierByElement.get(e);return t||(t=new Map,this.scopesByIdentifierByElement.set(e,t)),t}}],n&&Vt(t.prototype,n),r&&Vt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function _t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Kt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.application=t,this.scopeObserver=new Jt(this.element,this),this.scopesByIdentifier=new Ft,this.modulesByIdentifier=new Map}var t,n,r;return t=e,(n=[{key:"element",get:function(){return this.application.element}},{key:"modules",get:function(){return Array.from(this.modulesByIdentifier.values())}},{key:"contexts",get:function(){return this.modules.reduce((function(e,t){return e.concat(t.contexts)}),[])}},{key:"start",value:function(){this.scopeObserver.start()}},{key:"stop",value:function(){this.scopeObserver.stop()}},{key:"loadDefinition",value:function(e){this.unloadIdentifier(e.identifier);var t=new bt(this.application,e);this.connectModule(t);var n=e.controlConstructor.afterLoad;n&&n.call(e.controlConstructor,e.identifier,this.application)}},{key:"unloadIdentifier",value:function(e){var t=this.modulesByIdentifier.get(e);t&&this.disconnectModule(t)}},{key:"getModuleForIdentifier",value:function(e){return this.modulesByIdentifier.get(e)}},{key:"getContextForElementAndIdentifier",value:function(e,t){var n=this.modulesByIdentifier.get(t);if(n)return n.contexts.find((function(t){return t.element==e}))}},{key:"handleError",value:function(e,t,n){this.application.handleError(e,t,n)}},{key:"createScopeForElementAndIdentifier",value:function(e,t){return new At(e,t)}},{key:"scopeConnected",value:function(e){this.scopesByIdentifier.add(e.identifier,e);var t=this.modulesByIdentifier.get(e.identifier);t&&t.connectContextForScope(e)}},{key:"scopeDisconnected",value:function(e){this.scopesByIdentifier.delete(e.identifier,e);var t=this.modulesByIdentifier.get(e.identifier);t&&t.disconnectContextForScope(e)}},{key:"connectModule",value:function(e){this.modulesByIdentifier.set(e.identifier,e),this.scopesByIdentifier.getValuesForKey(e.identifier).forEach((function(t){return e.connectContextForScope(t)}))}},{key:"disconnectModule",value:function(e){this.modulesByIdentifier.delete(e.identifier),this.scopesByIdentifier.getValuesForKey(e.identifier).forEach((function(t){return e.disconnectContextForScope(t)}))}}])&&_t(t.prototype,n),r&&_t(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ht=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.started=!1,this.element=document.documentElement,this.dispatcher=new yt(this),this.container=new Kt(this)}var t,n,r;return t=e,n=[{key:"startAsync",value:function(){var e=this;new Promise((function(e){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){return e()})):e()})).then((function(){e.start()}))}},{key:"start",value:function(){this.started||(this.started=!0,this.dispatcher.start(),this.container.start())}},{key:"stop",value:function(){this.started&&(this.dispatcher.stop(),this.container.stop(),this.started=!1)}},{key:"register",value:function(e,t){this.load({identifier:e,controlConstructor:t})}},{key:"import",value:function(e){var t=this.container.getModuleForIdentifier(e);if(!t)throw new Error("Control is not registered: "+e);return t.controlConstructor}},{key:"fetch",value:function(e,t){return"string"==typeof e&&(e=document.querySelector(e)),t||(t=e.dataset.control),e?this.getControlForElementAndIdentifier(e,t):null}},{key:"fetchAll",value:function(e,t){var n=this;"string"==typeof e&&(e=document.querySelectorAll(e));var r=[];return e.forEach((function(e){var o=n.fetch(e,t);o&&r.push(o)})),r}},{key:"load",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=Array.isArray(e)?e:[e].concat(r);i.forEach((function(e){e.controlConstructor.shouldLoad&&t.container.loadDefinition(e)}))}},{key:"unload",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=Array.isArray(e)?e:[e].concat(r);i.forEach((function(e){return t.container.unloadIdentifier(e)}))}},{key:"controls",get:function(){return this.container.contexts.map((function(e){return e.control}))}},{key:"getControlForElementAndIdentifier",value:function(e,t){var n=this.container.getContextForElementAndIdentifier(e,t);return n?n.control:null}},{key:"handleError",value:function(e,t,n){var r;console.error("%s\n\n%o\n\n%o",t,e,n),null===(r=window.onerror)||void 0===r||r.call(window,t,"",0,0,e)}}],n&&Qt(t.prototype,n),r&&Qt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}());const $t={application:Ht,registerControl:function(e,t){return Ht.register(e,t)},importControl:function(e){return Ht.import(e)},fetchControl:function(e){return Ht.fetch(e)},fetchControls:function(e){return Ht.fetchAll(e)},start:function(){Ht.startAsync()},stop:function(){Ht.stop()}};function Xt(e){return Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xt(e)}window.oc||(window.oc={}),window.oc.AjaxObserve||(window.oc.AjaxObserve=$t,window.oc.registerControl=$t.registerControl,window.oc.importControl=$t.importControl,window.oc.fetchControl=$t.fetchControl,window.oc.fetchControls=$t.fetchControls,window.oc.ControlBase=lt,"function"==typeof define&&e.amdO||"object"==("undefined"==typeof exports?"undefined":Xt(exports))||$t.start())})();